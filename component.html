<polymer-element name="ceci-select" extends="ceci-element"
  attributes="collection" collection="Select">
  <ceci-definition>
    {
      "name": "Select",
      "tags": ["select", "data", "menu", "options"],
      "thumbnail": "./thumbnail.png",
      "description": "Presents a menu of options",
      "broadcasts": {
        "optionselected": {
          "label": "Selected option",
          "description": "Broadcasts the selected option."
        }
      },
      "listeners": {
      },
      "attributes": {
        "collection": {
          "description": "Collection where the options are stored",
          "label": "Collection"
        }
      }
    }
  </ceci-definition>
  <template>
    <link rel="stylesheet" href="component.css">
    <div class="Select">
      <div class="Select-help js-toggle-visibility">
        <h3>How to add options?</h3>
        <p>The options of the menu are stored in a collection named "Select".</p>
        <p>Edit these in the sidebar's App Data tab.</p>
        <button on-click="{{closeHelp}}" type="button">I understand!</button>
      </div>
      <select class="Select-element u-hidden js-toggle-visibility" on-change="{{selectOption}}">
        <template repeat="{{option in options}}">
          <option value="{{option.value}}">{{option.value}}</option>
        </template>
      </select>
    </div>
    <shadow></shadow>
  </template>
  <script>
    Polymer('ceci-select', {
      ready: function() {
        this.super();

        // Private attributes
        this.options = [];
        this.collections = document.querySelector('ceci-collections');
      },
      collectionReady: function () {
        var collection = this.collections.getCollection(this.collection);
        if (!collection.getField('value')) {
          collection.addField('value', 'text');
        }

        this.options = collection.data;
      },
      collectionChanged: function() {
        if (this.collection === '') {
          return;
        }
        var collection = this.collections.getCollection(this.collection);
        if (!collection) {
          this.collections.addCollection(this.collection);
        }
        this.async(this.collectionReady);
      },
      selectOption: function (event, detail, sender) {
        this.broadcast('optionselected', sender.value);
      },
      closeHelp: function () {
        var toggleble = this.shadowRoot.querySelectorAll('.js-toggle-visibility');
        [].slice.call(toggleble).forEach(function (el) {
          el.classList.toggle('u-hidden');
        });
      }
    });
  </script>
</polymer-element>
