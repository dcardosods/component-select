<polymer-element name="ceci-select" extends="ceci-element" attributes="collection" collection="">
  <ceci-definition>
    {
      "name": "Select",
      "tags": "select,data,menu,options",
      "thumbnail": "./thumbnail.png",
      "description": "Presents a menu of options",
      "broadcasts": {
      },
      "listeners": {
      },
      "attributes": {
        "collection": {
          "description": "Collection where the options are stored",
          "label": "Collection"
        }
      }
    }
  </ceci-definition>
  <template>
    <link rel="stylesheet" href="component.css">
    <div class="Select">
      <div class="Select-help js-toggleble">
        <h3>How to add options?</h3>
        <p>The options of the menu are stored in a collection named "Select".</p>
        <p>Each option has a label and its related value.</p>
        <p>Edit these in the sidebar's App Data tab.</p>
        <button on-click="{{closeHelp}}" type="button">I understand!</button>
      </div>
      <select class="Select-element u-hidden js-toggleble"></select>
    </div>
    <shadow></shadow>
  </template>
  <script>
    Polymer("ceci-select", {
      ready: function() {
        this.super();
        this.collections = document.querySelector("ceci-collections");
      },
      collectionReady: function () {
        var collection = this.collections.getCollection(this.collection);
        collection.addField('selected', 'checkbox');
        collection.addField('Option label', 'text');
        collection.addField('Option value', "text");
      },
      collectionChanged: function() {
        if (this.collection === '') {
          return;
        }
        var collection = this.collections.getCollection(this.collection);
        if (!collection) {
          this.collections.addCollection(this.collection);
        }
        this.async(this.collectionReady);
      },
      closeHelp: function () {
        var toggleble = this.shadowRoot.querySelectorAll('.js-toggleble');
        [].slice.call(toggleble).forEach(function (el) {
          el.classList.toggle('u-hidden');
        });

        this.collection = 'Select';
      }
    });
  </script>
</polymer-element>
